<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Single-File Proxy Browser</title>
<style>
  body { 
    font-family: 'Segoe UI', Arial, sans-serif; 
    margin: 0; 
    display: flex; 
    flex-direction: column; 
    height: 100vh; 
    background-color: #333; 
  }
  .browser-header { 
    background: #e0e0e0; 
    padding: 10px; 
    display: flex; 
    flex-direction: column; 
    gap: 10px; 
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 10;
  }
  .tabs { 
    display: flex; 
    gap: 5px; 
    align-items: center; 
  }
  .tab { 
    padding: 6px 15px; 
    background: #bbb; 
    cursor: pointer; 
    border-radius: 6px 6px 0 0; 
    font-size: 14px; 
  }
  .tab.active { 
    background: #fff; 
    font-weight: bold; 
  }
  .controls { 
    display: flex; 
    gap: 8px; 
  }
  input[type="text"] { 
    flex-grow: 1; 
    padding: 8px 12px; 
    font-size: 14px; 
    border: 1px solid #ccc; 
    border-radius: 4px; 
    outline: none; 
  }
  input[type="text"]:focus {
    border-color: #888;
  }
  button { 
    padding: 8px 16px; 
    cursor: pointer; 
    background-color: #2ea44f; 
    color: white; 
    border: none; 
    border-radius: 4px; 
    font-weight: bold; 
  }
  button:hover { 
    background-color: #2c974b; 
  }
  .browser-frame { 
    flex-grow: 1; 
    border: none; 
    width: 100%; 
    background: #fff; 
  }
  .loading { 
    display: none; 
    font-size: 12px; 
    color: #555; 
    margin-left: 10px; 
    font-style: italic; 
  }
</style>
</head>
<body>

<div class="browser-header">
  <div class="tabs">
    <div class="tab active">Tab 1</div>
    <span id="loadingStatus" class="loading">Fetching page...</span>
  </div>
  <form id="navigationForm" class="controls">
    <input type="text" id="urlInput" placeholder="Enter URL (e.g., example.com)" required>
    <button type="submit">Go</button>
  </form>
</div>

<iframe id="mainFrame" class="browser-frame" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>

<script>
  const form = document.getElementById('navigationForm');
  const iframe = document.getElementById('mainFrame');
  const loadingStatus = document.getElementById('loadingStatus');
  const urlInput = document.getElementById('urlInput');

  // PROXY 1: CorsProxy.io (Often bypasses Wiki blocks if fetched as text)
  async function fetchWithCorsProxy(url) {
    const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`);
    if (!response.ok) throw new Error('CorsProxy failed');
    return await response.text();
  }

  // PROXY 2: AllOrigins
  async function fetchWithAllOrigins(url) {
    const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
    if (!response.ok) throw new Error('AllOrigins failed');
    const data = await response.json();
    if (!data.contents) throw new Error('No content from AllOrigins');
    return data.contents;
  }

  // PROXY 3: CodeTabs 
  async function fetchWithCodeTabs(url) {
    const response = await fetch(`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`);
    if (!response.ok) throw new Error('CodeTabs failed');
    return await response.text(); 
  }

  async function loadUrl(inputUrl) {
    if (!inputUrl.startsWith('http://') && !inputUrl.startsWith('https://')) {
        inputUrl = 'https://' + inputUrl; 
    }
    
    urlInput.value = inputUrl;
    loadingStatus.style.display = 'inline';
    loadingStatus.textContent = 'Fetching page...';
    iframe.srcdoc = ''; 

    let htmlContent = '';

    try {
      loadingStatus.textContent = 'Trying Proxy 1...';
      htmlContent = await fetchWithCorsProxy(inputUrl);
    } catch (err1) {
      try {
        loadingStatus.textContent = 'Proxy 1 blocked. Trying Proxy 2...';
        htmlContent = await fetchWithAllOrigins(inputUrl);
      } catch (err2) {
        try {
          loadingStatus.textContent = 'Proxy 2 blocked. Trying Proxy 3...';
          htmlContent = await fetchWithCodeTabs(inputUrl);
        } catch (err3) {
          loadingStatus.style.display = 'none';
          iframe.srcdoc = `<div style="font-family:sans-serif; padding: 20px;">
            <h2>Access Denied</h2>
            <p>All 3 proxies were blocked by the target website.</p>
            <p><strong>Reason:</strong> The site (like Wikipedia or Google) is actively blocking public proxies and requires a custom User-Agent, which frontend JavaScript is forbidden from sending.</p>
            </div>`;
          return; 
        }
      }
    }

    // INJECTION HACK: Add <base> tag and click interceptor
    const injectionCode = `
      <base href="${inputUrl}">
      <script>
        document.addEventListener('click', function(e) {
          let target = e.target.closest('a');
          if (target && target.href && !target.href.startsWith('javascript:')) {
            e.preventDefault(); 
            window.parent.postMessage({ action: 'navigate', url: target.href }, '*');
          }
        });
      <\/script>
    `;
    
    // Safely inject the code into the fetched HTML
    if (htmlContent.includes('<head>')) {
      htmlContent = htmlContent.replace('<head>', '<head>' + injectionCode);
    } else {
      htmlContent = injectionCode + htmlContent;
    }

    // Render inside the iframe
    iframe.srcdoc = htmlContent;
    loadingStatus.style.display = 'none';
  }

  form.addEventListener('submit', function(e) {
    e.preventDefault();
    loadUrl(urlInput.value.trim());
  });

  window.addEventListener('message', function(event) {
    if (event.data && event.data.action === 'navigate') {
      loadUrl(event.data.url);
    }
  });
</script>

</body>
</html>